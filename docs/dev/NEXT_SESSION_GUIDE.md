# Next Session Guide

## Session Context

**Last Session Date**: 2026-01-29
**Current Status**: æ¶æ„æ–‡æ¡£æ›´æ–°å®Œæˆï¼ŒPhase 5 éƒ¨åˆ†å®Œæˆ
**Design Document**: `docs/design/LURKBOT_COMPLETE_DESIGN.md` (v2.3)
**Architecture Document**: `docs/design/MOLTBOT_COMPLETE_ARCHITECTURE.md` (v3.0, 32 ç« èŠ‚)

## What Was Accomplished

### ä»Šæ—¥å®Œæˆçš„å·¥ä½œ

1. **MoltBot æ¶æ„æ–‡æ¡£å…¨é¢æ›´æ–°** - å‘ç°å¹¶è®°å½•äº†å…¨éƒ¨é—æ¼æ¨¡å—ï¼š

   **ç¬¬ä¸€è½®å‘ç°ï¼ˆ7 ä¸ªæ¨¡å—ï¼‰**:
   | ç« èŠ‚ | æ¨¡å— | ä»£ç é‡ |
   |------|------|--------|
   | äºŒå | Auto-Reply è‡ªåŠ¨å›å¤ç³»ç»Ÿ | ~23K LOC |
   | äºŒåä¸€ | Daemon å®ˆæŠ¤è¿›ç¨‹ç³»ç»Ÿ | ~33 æ–‡ä»¶ |
   | äºŒåäºŒ | Media Understanding å¤šåª’ä½“ç†è§£ | ~22 æ–‡ä»¶ |
   | äºŒåä¸‰ | Provider Usage ä½¿ç”¨é‡ç›‘æ§ | ~19 æ–‡ä»¶ |
   | äºŒåå›› | Routing æ¶ˆæ¯è·¯ç”±ç³»ç»Ÿ | ~6 æ–‡ä»¶ |
   | äºŒåäº” | Hooks æ‰©å±•ç³»ç»Ÿ | ~30 æ–‡ä»¶ |
   | äºŒåå…­ | Security å®‰å…¨å®¡è®¡ç³»ç»Ÿ | ~11 æ–‡ä»¶ |

   **ç¬¬äºŒè½®å‘ç°ï¼ˆ6 ä¸ªæ¨¡å—ï¼‰**:
   | ç« èŠ‚ | æ¨¡å— | ä»£ç é‡ |
   |------|------|--------|
   | äºŒåä¸ƒ | ACP åè®®ç³»ç»Ÿ | ~13 æ–‡ä»¶ |
   | äºŒåå…« | Browser æµè§ˆå™¨è‡ªåŠ¨åŒ– | ~81 æ–‡ä»¶ |
   | äºŒåä¹ | TUI ç»ˆç«¯ç•Œé¢ | ~37 æ–‡ä»¶ |
   | ä¸‰å | TTS è¯­éŸ³åˆæˆ | ~2 æ–‡ä»¶ |
   | ä¸‰åä¸€ | Wizard é…ç½®å‘å¯¼ | ~9 æ–‡ä»¶ |
   | ä¸‰åäºŒ | Infra åŸºç¡€è®¾æ–½ï¼ˆ8 å­ç³»ç»Ÿï¼‰ | ~182 æ–‡ä»¶ |

2. **LurkBot è®¾è®¡æ–‡æ¡£æ›´æ–° (v2.3)**ï¼š
   - æ–°å¢ Phase 18-23 å®æ–½è®¡åˆ’
   - æ€»å®æ–½å‘¨æœŸä» 18 å‘¨æ‰©å±•åˆ° 24 å‘¨
   - åŠŸèƒ½æ£€æŸ¥æ¸…å•ä» 37 é¡¹æ‰©å±•åˆ° 50 é¡¹
   - å…³é”®æ–‡ä»¶æ¸…å•æ–°å¢ 12 ä¸ªæ¨¡å—ç›®å½•

3. **æ–‡æ¡£è¦†ç›–ç‡æå‡**: ä» ~85% æå‡åˆ° ~95%+

## Implementation Plan (23 Phases)

| Phase | å†…å®¹ | çŠ¶æ€ |
|-------|------|------|
| **Phase 1** | é¡¹ç›®é‡æ„ - æ¸…ç†æ—§ä»£ç  | âœ… å®Œæˆ |
| **Phase 2** | PydanticAI æ ¸å¿ƒæ¡†æ¶é›†æˆ | âœ… å®Œæˆ |
| **Phase 3** | Bootstrap æ–‡ä»¶ç³»ç»Ÿ + ç³»ç»Ÿæç¤ºè¯ | âœ… å®Œæˆ |
| **Phase 4** | ä¹å±‚å·¥å…·ç­–ç•¥ç³»ç»Ÿ | âœ… å®Œæˆ |
| **Phase 5** | 22 ä¸ªåŸç”Ÿå·¥å…·å®ç° | ğŸ”„ è¿›è¡Œä¸­ |
| **Phase 6** | ä¼šè¯ç®¡ç† + å­ä»£ç†ç³»ç»Ÿ | â³ å¾…å¼€å§‹ |
| **Phase 7** | Heartbeat + Cron è‡ªä¸»è¿è¡Œç³»ç»Ÿ | â³ å¾…å¼€å§‹ |
| **Phase 8** | Auth Profile + Context Compaction | â³ å¾…å¼€å§‹ |
| **Phase 9** | Gateway WebSocket åè®® | â³ å¾…å¼€å§‹ |
| **Phase 10** | æŠ€èƒ½å’Œæ’ä»¶ç³»ç»Ÿ | â³ å¾…å¼€å§‹ |
| **Phase 11** | A2UI Canvas Host | â³ å¾…å¼€å§‹ |
| **Phase 12** | Auto-Reply + Routing | â³ å¾…å¼€å§‹ |
| **Phase 13** | Daemon å®ˆæŠ¤è¿›ç¨‹ | â³ å¾…å¼€å§‹ |
| **Phase 14** | Media Understanding | â³ å¾…å¼€å§‹ |
| **Phase 15** | Provider Usage ç›‘æ§ | â³ å¾…å¼€å§‹ |
| **Phase 16** | Hooks æ‰©å±•ç³»ç»Ÿ | â³ å¾…å¼€å§‹ |
| **Phase 17** | Security å®‰å…¨å®¡è®¡ | â³ å¾…å¼€å§‹ |
| **Phase 18** | ACP åè®®ç³»ç»Ÿ | â³ **æ–°å¢** |
| **Phase 19** | Browser æµè§ˆå™¨è‡ªåŠ¨åŒ– | â³ **æ–°å¢** |
| **Phase 20** | TUI ç»ˆç«¯ç•Œé¢ | â³ **æ–°å¢** |
| **Phase 21** | TTS è¯­éŸ³åˆæˆ | â³ **æ–°å¢** |
| **Phase 22** | Wizard é…ç½®å‘å¯¼ | â³ **æ–°å¢** |
| **Phase 23** | Infra åŸºç¡€è®¾æ–½ | â³ **æ–°å¢** |

## æ–°å¢æ¨¡å—æ¦‚è¿°

### ACP åè®®ç³»ç»Ÿ (Phase 18)
- **Agent Control Protocol**: IDE é›†æˆåè®®
- **ndJSON æµ**: stdin/stdout åŒå‘é€šä¿¡
- **ä¼šè¯éš”ç¦»**: IDE çº§åˆ«ç‹¬ç«‹ä¼šè¯
- **å·¥å…·é›†**: text_editor, shell ç­‰

### Browser æµè§ˆå™¨è‡ªåŠ¨åŒ– (Phase 19)
- **Playwright + CDP**: åŒæ¨¡å¼æ”¯æŒ
- **æˆªå›¾ä¼˜åŒ–**: æ™ºèƒ½è£å‰ªã€å‹ç¼©
- **Role/ARIA å¿«ç…§**: å¯è®¿é—®æ€§æ ‘æå–
- **æ‰©å±•ä¸­ç»§**: æµè§ˆå™¨æ‰©å±•é€šä¿¡

### TUI ç»ˆç«¯ç•Œé¢ (Phase 20)
- **pi-tui é£æ ¼**: äº¤äº’å¼ç»ˆç«¯
- **æµåˆ†ç¦»å™¨**: thinking/content åˆ†ç¦»
- **å‘½ä»¤å¤„ç†å™¨**: å¿«æ·é”®å’Œå‘½ä»¤

### TTS è¯­éŸ³åˆæˆ (Phase 21)
- **å¤šæä¾›å•†**: OpenAI, ElevenLabs, Edge TTS
- **æŒ‡ä»¤æ ‡ç­¾**: `[[tts:...]]` è§£æ
- **è‡ªåŠ¨æ‘˜è¦**: é•¿æ–‡æœ¬å¤„ç†

### Wizard é…ç½®å‘å¯¼ (Phase 22)
- **Promise-based ä¼šè¯**: äº¤äº’å¼å¼•å¯¼
- **QuickStart/Advanced**: ä¸¤ç§æ¨¡å¼
- **é‡ç½®ç­–ç•¥**: é…ç½®è¿ç§»

### Infra åŸºç¡€è®¾æ–½ (Phase 23)
8 ä¸ªå­ç³»ç»Ÿï¼š
- **system-events**: éŸ³é¢‘è¾“å…¥/å‰ªè´´æ¿/æ–‡ä»¶å˜åŒ–
- **system-presence**: è®¾å¤‡åœ¨çº¿çŠ¶æ€
- **tailscale**: VPN é›†æˆ
- **ssh-tunnel**: SSH éš§é“ç®¡ç†
- **bonjour**: mDNS æœåŠ¡å‘ç°
- **device-pairing**: PKI è®¾å¤‡é…å¯¹
- **exec-approvals**: æ‰§è¡Œå®¡æ‰¹ç³»ç»Ÿ
- **voicewake**: è¯­éŸ³å”¤é†’

## Quick Start for Next Session

```bash
# 1. è¿è¡Œæµ‹è¯•ç¡®è®¤å½“å‰çŠ¶æ€
python -m pytest tests/ -xvs

# 2. æŸ¥çœ‹æ›´æ–°åçš„è®¾è®¡æ–‡æ¡£
cat docs/design/LURKBOT_COMPLETE_DESIGN.md | head -200

# 3. æŸ¥çœ‹ MoltBot æ¶æ„æ–‡æ¡£ï¼ˆ32 ç« èŠ‚ï¼‰
cat docs/design/MOLTBOT_COMPLETE_ARCHITECTURE.md | head -50

# 4. é€‰æ‹©ä¸‹ä¸€æ­¥æ–¹å‘ï¼š
# æ–¹æ¡ˆ A: ç»§ç»­ Phase 5 - å®Œæˆå‰©ä½™å·¥å…·
# æ–¹æ¡ˆ B: å¼€å§‹ Phase 6 - ä¼šè¯ç®¡ç†ç³»ç»Ÿ
# æ–¹æ¡ˆ C: è·³åˆ° Phase 12 - Auto-Reply ç³»ç»Ÿï¼ˆæ¶ˆæ¯å¤„ç†æ ¸å¿ƒï¼‰
```

## Key References

### æ–‡æ¡£ä½ç½®
```
docs/design/
â”œâ”€â”€ MOLTBOT_ANALYSIS.md              # åŸºç¡€åˆ†æ
â”œâ”€â”€ MOLTBOT_COMPLETE_ARCHITECTURE.md # å®Œæ•´æ¶æ„ï¼ˆ32 ç« èŠ‚ï¼Œv3.0ï¼‰
â””â”€â”€ LURKBOT_COMPLETE_DESIGN.md       # å¤åˆ»è®¾è®¡ï¼ˆv2.3, 23 é˜¶æ®µï¼‰
```

### æ–°å¢æ¨¡å—ç›®å½•ç»“æ„é¢„è§ˆ
```
src/lurkbot/
â”œâ”€â”€ acp/                 # Phase 18 [æ–°å¢]
â”‚   â”œâ”€â”€ server.py
â”‚   â”œâ”€â”€ protocol.py
â”‚   â””â”€â”€ session.py
â”œâ”€â”€ browser/             # Phase 19 [æ–°å¢]
â”‚   â”œâ”€â”€ playwright_manager.py
â”‚   â”œâ”€â”€ cdp_client.py
â”‚   â””â”€â”€ screenshot.py
â”œâ”€â”€ tui/                 # Phase 20 [æ–°å¢]
â”‚   â”œâ”€â”€ app.py
â”‚   â””â”€â”€ stream_assembler.py
â”œâ”€â”€ tts/                 # Phase 21 [æ–°å¢]
â”‚   â”œâ”€â”€ engine.py
â”‚   â””â”€â”€ providers/
â”œâ”€â”€ wizard/              # Phase 22 [æ–°å¢]
â”‚   â”œâ”€â”€ session.py
â”‚   â””â”€â”€ flows/
â””â”€â”€ infra/               # Phase 23 [æ‰©å±•]
    â”œâ”€â”€ system_events/
    â”œâ”€â”€ system_presence/
    â”œâ”€â”€ tailscale/
    â”œâ”€â”€ ssh_tunnel/
    â”œâ”€â”€ bonjour/
    â”œâ”€â”€ device_pairing/
    â”œâ”€â”€ exec_approvals/
    â””â”€â”€ voicewake/
```

## Important Notes

### å¼€å‘åŸåˆ™
1. **å®Œå…¨å¤åˆ»**: æ‰€æœ‰ MoltBot åŠŸèƒ½å¿…é¡»å®ç°ï¼Œä¸èƒ½é—æ¼
2. **ä¸¥æ ¼å¯¹æ ‡**: æ—¶åˆ»å‚è€ƒ MoltBot æºç ç¡®ä¿ä¸€è‡´æ€§
3. **ä¸è‡ªè¡Œä¹±ç¼–**: prompts ç­‰å…³é”®å†…å®¹å¿…é¡»ä» MoltBot æºç æå–
4. **æœ‰ä¸æ˜ä¹‹å¤„åŠæ—¶åœä¸‹æ¥é—®**: é‡åˆ°ä¸ç¡®å®šçš„åœ°æ–¹è¦ç¡®è®¤

### æŠ€æœ¯æ ˆ
- **Agent æ¡†æ¶**: PydanticAI
- **Web æ¡†æ¶**: FastAPI
- **éªŒè¯**: Pydantic
- **CLI**: Typer
- **æ—¥å¿—**: Loguru

### æ–°å‘ç°æ¨¡å—ä¼˜å…ˆçº§
| æ¨¡å— | ä¼˜å…ˆçº§ | ç†ç”± |
|------|--------|------|
| Auto-Reply | **P0** | æ¶ˆæ¯å¤„ç†æ ¸å¿ƒï¼Œå½±å“æ‰€æœ‰äº¤äº’ |
| ACP | **P1** | IDE é›†æˆï¼Œå¼€å‘è€…ä½“éªŒ |
| Browser | P1 | ç½‘é¡µè‡ªåŠ¨åŒ–èƒ½åŠ› |
| Daemon | P1 | ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¿…éœ€ |
| Routing | P1 | å¤šæ¸ é“æ¶ˆæ¯åˆ†å‘ |
| TUI | P2 | å¼€å‘è°ƒè¯•å·¥å…· |
| TTS | P2 | è¯­éŸ³è¾“å‡ºæ‰©å±• |
| Wizard | P1 | ç”¨æˆ·å¼•å¯¼ä½“éªŒ |
| Infra | P2 | é«˜çº§åŠŸèƒ½æ”¯æ’‘ |

---

**Document Updated**: 2026-01-29
**Next Action**:
1. ç»§ç»­ Phase 5 æˆ–å¼€å§‹ Phase 6
2. è€ƒè™‘ä¼˜å…ˆå®ç° Phase 12 (Auto-Reply) - è¿™æ˜¯æ¶ˆæ¯å¤„ç†çš„æ ¸å¿ƒ
3. è€ƒè™‘ä¼˜å…ˆå®ç° Phase 18 (ACP) - IDE é›†æˆæ”¯æŒ
4. é˜¶æ®µå®Œæˆåä¸ MoltBot å¯¹æ¯”éªŒè¯
